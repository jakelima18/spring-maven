apiVersion: apps/v1
kind: Deployment
metadata:
  name: api2-test
  labels:
    app: api2
spec:
  replicas: 1
  selector:
    matchLabels:
      app: api2
  template:
    metadata:
      labels:
        app: api2
    spec:
      containers:
      - name: api2
        image: nexus-service/transaction-history:v1
        ports:
        - containerPort: 8088
        env:
        - name: SPRING_DATA_MONGODB_AUTHENTICATION-DATABASE
          value: "admin"
        - name: SPRING_DATA_MONGODB_USERNAME
          value: "root"
        - name: SPRING_DATA_MONGODB_PASSWORD
          value: "flexDev"
        - name: SPRING_DATA_MONGODB_PASSWORD
          value: "flexDev"  
        - name: SPRING_DATA_MONGODB_PORT
          value: "27017"     
      
      - name: mongo
        image: mongo:4.2
        env:
        - name: MONGO_INITDB_ROOT_USERNAME
          value: root
        - name: MONGO_INITDB_ROOT_PASSWORD
          value: flexDev
        ports:
        - containerPort: 27017


services:
  flex-transaction-history:
    image: flex/transaction-history
    restart: always
    ports:
      - 80:8088
    environment:
      SPRING_DATA_MONGODB_AUTHENTICATION-DATABASE: admin
      SPRING_DATA_MONGODB_USERNAME: root
      SPRING_DATA_MONGODB_PASSWORD: flexDev
      SPRING_DATA_MONGODB_HOST: flex-mongo
      SPRING_DATA_MONGODB_PORT: 27017
      SPRING_DATA_MONGODB_DATABASE: flex        